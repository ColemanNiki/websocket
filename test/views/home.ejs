<!DOCTYPE html>
<html>

<head>
  <title>
    <%= title %>
  </title>
  <link rel='stylesheet' href='/stylesheets/style.css' />
  <style type="text/css">
    a {
      margin-left: 20px;
      text-decoration: none;
    }
    
    a:hover {
      text-decoration: underline;
    }
  </style>
  <script src="javascripts/jquery.min.js"></script>
  <script src="javascripts/messageTip.js"></script>
</head>

<body>
  <h1>
    <%= title %>
  </h1>
  <p>Welcome to
    <%= title %>
  </p>
  <p><a href="/outlogin">注销 </a> 标题： <input type="text" id='liveTitle' width="100px" /> 简介： <input type="text" id='liveMsg'
      width="100px" />
    <button id="idBtn" class="btn btn-info col-sm-2 col-sm-offset-10">获得我的直播Id</button>
    <input type="text" id="liveURL" width="100px" /> 下载推流软件： <a href="download/ffmpeg.rar" download="ffmpeg.rar">下载</a>
  </p>
  <ul id='roomList'>
  </ul>
</body>
<script>
  $.ajax({
    url:'/users/getLiveRoomList',
    tyep:'get',
    data:{},
    success:function(data){
      if(data.success == 0)
        alert(msgTip[data.message]);
      else{
        var roomList = "";
        data.message.forEach(function(room){
          var roomDom = '<li> 主播：'+room.name;
          if(room.state == 1){
            roomDom += ' 正在直播 <a  target="_Blank" href="'+window.location.protocol+"//"+window.location.host+"/show?room=" +room._id +'">观看</a></li>';
          }
          else{
            roomDom += '未开始直播</li>';
          }
          roomList += roomDom;
        });
        $('#roomList').append(roomList);
        console.log(data.message);
      }
    },
    error:function(data){

    }
  })
  $('#idBtn').click(function () {
    $.ajax({
      url: '/users/getId',
      type: 'post',
      data: {
        liveTitle: $('#liveTitle').val(),
        liveMsg: $('#liveMsg').val()
      },
      success: function (data) {
        console.log(data);
        if (data.success == 1) {
          $("#liveURL").val(data.message.sendUrl);
        }
        else {
          console.log(msgTip[data.message]);
        }
      },
      error: function (data, status) {
        console.log("1");
      }
    });
  })
</script>

</html>